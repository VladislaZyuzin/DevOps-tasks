# Поднятие K3S и Docker Swarm через Salt-Stack 
> Объяснение, как настраивается Salt-Stack ("соль" - по-церковнославянски) можно подчерпнуть отсюда: [Настройка Salt-Stack](https://github.com/VladislaZyuzin/DevOps-tasks/tree/main/SaltStack/kube_swarm_salt)

## ТЗ 
1. Настроить Docker-Swarm на одной ноде
2. Настроить K3S или K8S на 2 и болеее нодах
3. Задеплоить сервисы для тестирования

## Начало работы

Для того, чтобы всё корректно завелось - я воспользовался сервером компании и создал через Proxmox 7 ВМ: 

<img width="741" height="312" alt="image" src="https://github.com/user-attachments/assets/10e57994-1a50-435a-9f6d-ee3203fa6b57" />

Особое внимание стоит уделить на: 
1. Первый столбикк (VMID) - это номер ВМ в проксмоксе, чтобы можно было логически их связать
2. Предпоследний столбик - тут оперативка в мб
3. Последний - тут основная память в гб

Для работы я использовал дистрибутивы **12_ubuntu-24.04.3-live-server-amd64.iso**. На эту версию спокойно устанавливается соль, которую я настраивал в прошлой статьте через boorstrap. В ютубе есть множество видно о том, как устанавливается серверная убунта, так что дерзайте :)

Не буду долно рассказывать про сеть - основная подсеть для проектов у меня 10.70.8.0/23
* Шлюз - оканчивается на 1
* Salt-master - на 10
* salt-swarm - на 20
* salt-k8s-master - на 30
* salt-k8s-worker1 - на 31
* salt-k8s-worker2 - на 32
* salt-k3s-master - на 40
* salt-k3s-worker - на 41

Далее - я настроил salt и salt-ssh (в дальнейщем - он не пригодился :( ) на всех вм. Прописал roster. В папках с конфигами будет всё необходимое. Перейдём же к настройке остальный сервисов

## Docker-Swarm
Для настройки сворма было использовано, в целом, всё то же, что и на `wsl`, были немного изменены конфиги и команды вызова. Из хорошей практики - был настроен пиллар. Вот как всё выглядит: 

```bash
cat /srv/pillar/swarm.sls

```yaml 
swarm:
  # IP адрес для advertise-addr
  advertise_addr: 10.70.8.20

  # Дополнительные параметры если нужно
  interface: eth0
  port: 2377
  data_path_addr: 10.70.8.20

  # Настройки для токенов
  token_dir: /etc/docker/swarm
```
```
